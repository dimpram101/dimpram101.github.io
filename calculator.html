<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculator</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="/styles/calculator.css">
</head>

<body>
  <header>
    <div class="header-content container">
      <div class="header-title">
        <h1>Desain Web B - Tugas 2</h1>
      </div>

      <div id="error">
      </div>

      <div class="header-list">
        <a href="index.html">Home</a>
        <a class="active" href="calculator.html">Calculator</a>
      </div>

      <div class="hamburger-menu" style="position: relative;">
        <input type="checkbox">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
        <div class="menu">
          <div class="menu-list">
            <a href="index.html">Home</a>
            <a href="coming_soon.html">Coming Soon</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container calculator-layout">
    <div class="display">
      <input type="text" readonly class="number-input" id="displayInput" value="0">
    </div>
    <div class="input-grid">
      <div class="number-box" onclick="resetDisplay()">DEL</div>
      <div class="number-box" onclick="calculateSqrt()">sqrt()</div>
      <div class="number-box" onclick="addOperator('%')">%</div>
      <div class="number-box" onclick="addOperator('/')">/</div>

      <div class="number-box" onclick="addNumber(1)">1</div>
      <div class="number-box" onclick="addNumber(2)">2</div>
      <div class="number-box" onclick="addNumber(3)">3</div>
      <div class="number-box" onclick="addOperator('*')">X</div>

      <div class="number-box" onclick="addNumber(4)">4</div>
      <div class="number-box" onclick="addNumber(5)">5</div>
      <div class="number-box" onclick="addNumber(6)">6</div>
      <div class="number-box" onclick="addOperator('+')">+</div>

      <div class="number-box" onclick="addNumber(7)">7</div>
      <div class="number-box" onclick="addNumber(8)">8</div>
      <div class="number-box" onclick="addNumber(9)">9</div>
      <div class="number-box" onclick="addOperator('-')">-</div>

      <div class="number-box zero" onclick="addNumber(0)">0</div>
      <div class="number-box" onclick="addComma()">.</div>
      <div class="number-box" onclick="calculate()"> = </div>
    </div>
  </div>

  <script>
    let operatorRegex = /[+xX\-*/%]/;
    let isCalculatingPercent = false;
    let isSecondInput = false;

    function resetDisplay() {
      document.getElementById('displayInput').value = "0";
      isSecondInput = false;
    }

    function addNumber(number) {
      let display = document.getElementById('displayInput');
      if (display.value === "0" && number === 0) {
        return;
      }

      if (display.value.substring(display.value.length - 2, display.value.length) == ' 0') {
        display.value = display.value.slice(0, display.value.length - 1) + number
      } else if (display.value === "0" && number !== '.') {
        display.value = `${number}`
      } else {
        display.value += `${number}`
      }
    }

    function addComma() {
      let display = document.getElementById('displayInput');
      const arr = display.value.split(" ");
      if (arr.length > 2) {
        if (arr[2].includes(".")) {
          return;
        }
        display.value += "."
      } else {
        if (arr[0].includes(".")) {
          return;
        }
        display.value += "."
      }
    }

    function addOperator(operator) {
      let display = document.getElementById('displayInput');
      if (!display.value) {
        return;
      }

      if (operatorRegex.test(display.value.slice(-2))) {
        display.value = display.value.slice(0, display.value.length - 2) + operator + " ";
        return;
      }

      if (!operatorRegex.test(display.value) && operator === "%") {
        display.value += `${operator} of `;
        isCalculatingPercent = true;
      }

      if (isCalculatingPercent) return;

      if (operatorRegex.test(display.value)) {
        calculate()
        display.value += ` ${operator} `;
      }
      else {
        display.value += ` ${operator} `;
      }

      isSecondInput = true;
    }

    function calculate() {
      let display = document.getElementById('displayInput');

      if (isCalculatingPercent) {
        const arr = display.value.split("% of ");
        display.value = `${(parseFloat(arr[0]) / 100) * arr[1]}`
        return;
      }

      const arr = display.value.split(' ');
      if (arr[1] === "*") {
        display.value = `${parseFloat(arr[0]) * parseFloat(arr[2])}`
      } else if (arr[1] === "/") {
        display.value = `${parseFloat(arr[0]) / parseFloat(arr[2])}`
      } else if (arr[1] === "-") {
        display.value = `${parseFloat(arr[0]) - parseFloat(arr[2])}`
      } else if (arr[1] === "+") {
        display.value = `${parseFloat(arr[0]) + parseFloat(arr[2])}`
      }

      document.getElementById('error').innerHTML = ""
      isSecondInput = true;
    }

    function calculateSqrt() {
      let display = document.getElementById('displayInput');
      if (operatorRegex.test(display.value)) {
        document.getElementById('error').innerHTML = "<i>Terjadi kesalahan<i>"
      } else {
        display.value = `${Math.sqrt(parseFloat(display.value))}`
      }
    }

    document.addEventListener('keydown', function (event) {
      if (event.key >= 0 && event.key <= 9 && event.key !== " ") {
        addNumber(event.key)
      } else if (event.key === ".") {
        addComma()
      } else if (event.key === "Backspace") {
        resetDisplay()
      } else if (event.key === "Enter") {
        calculate()
      } else if (event.key === "+") {
        addOperator("+")
      } else if (event.key === "-") {
        addOperator("-")
      } else if (event.key === "*") {
        addOperator("*")
      } else if (event.key === "/") {
        addOperator("/")
      } else if (event.key === "%") {
        addOperator("%")
      } else if (event.key === " ") {
        addOperator("+")
      }
    })
  </script>
</body>

</html>